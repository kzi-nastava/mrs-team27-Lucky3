<div class="min-h-[calc(100vh-64px)] bg-slate-950 text-slate-100">
  <div class="mx-auto max-w-6xl px-4 py-6">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-xl font-semibold tracking-tight">User blocking</h2>
        <p class="mt-1 text-sm text-slate-400">
          Block/unblock users. Provide a reason when blocking.
        </p>
      </div>

      <button
        type="button"
        (click)="refresh()"
        class="inline-flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm text-slate-200 hover:bg-slate-800"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-alert">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
          <path d="M12 8v4"/>
          <path d="M12 16h.01"/>
        </svg>
        Refresh
      </button>
    </div>

    <ng-container *ngIf="vm$ | async as vm">
      <!-- Tabs -->
      <div class="mt-6 flex w-full items-center gap-2 rounded-xl border border-slate-800 bg-slate-900 p-1">
        <button
          type="button"
          (click)="activeTab='unblocked'"
          class="flex-1 rounded-lg px-3 py-2 text-sm font-medium transition"
          [ngClass]="activeTab==='unblocked'
            ? 'bg-slate-800 text-slate-50'
            : 'text-slate-300 hover:bg-slate-800/50'"
        >
          Unblocked
          <span class="ml-2 rounded-md bg-slate-800 px-2 py-0.5 text-xs text-slate-200">
            {{ vm.unblocked.length }}
          </span>
        </button>

        <button
          type="button"
          (click)="activeTab='blocked'"
          class="flex-1 rounded-lg px-3 py-2 text-sm font-medium transition"
          [ngClass]="activeTab==='blocked'
            ? 'bg-slate-800 text-slate-50'
            : 'text-slate-300 hover:bg-slate-800/50'"
        >
          Blocked
          <span class="ml-2 rounded-md bg-slate-800 px-2 py-0.5 text-xs text-slate-200">
            {{ vm.blocked.length }}
          </span>
        </button>
      </div>

      <!-- Unblocked table -->
      <div *ngIf="activeTab==='unblocked'" class="mt-4 overflow-hidden rounded-xl border border-slate-800 bg-slate-950">
        <div class="overflow-x-auto">
          <table class="min-w-full text-left text-sm">
            <thead class="bg-slate-900 text-slate-300">
              <tr>
                <th class="px-4 py-3 w-14"></th>
                <th class="px-4 py-3">User</th>
                <th class="px-4 py-3">Email</th>
                <th class="px-4 py-3 text-right">Action</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-slate-900">
              <tr *ngFor="let u of vm.unblocked; trackBy: trackByUserEmail" class="hover:bg-slate-900/40">
                <!-- Photo -->
                <td class="px-4 py-3">
                  <div class="h-10 w-10 overflow-hidden rounded-full border border-slate-800 bg-slate-900">
                    <img *ngIf="u.imageUrl; else noPhotoU"
                         [src]="u.imageUrl"
                         class="h-full w-full object-cover"
                         alt="Profile photo" />
                    <ng-template #noPhotoU>
                      <div class="grid h-full w-full place-items-center text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user">
                          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                          <circle cx="12" cy="7" r="4"/>
                        </svg>
                      </div>
                    </ng-template>
                  </div>
                </td>

                <!-- Name -->
                <td class="px-4 py-3">
                  <div class="font-medium text-slate-100">{{ u.name }} {{ u.surname }}</div>
                  <div class="mt-0.5 text-xs text-slate-400">{{ u.address }}</div>
                </td>

                <!-- Email -->
                <td class="px-4 py-3">
                  <div class="flex items-center gap-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail text-slate-400">
                      <rect width="20" height="16" x="2" y="4" rx="2"/>
                      <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                    </svg>
                    <span class="truncate">{{ u.email }}</span>
                  </div>
                </td>

                <!-- Action -->
                <td class="px-4 py-3">
                  <div class="flex items-center justify-end gap-3">
                    <button
                      type="button"
                      (click)="block(u)"
                      [disabled]="isBusy(u.email)"
                      class="inline-flex items-center gap-2 rounded-lg bg-yellow-400 px-3 py-2 text-sm font-semibold text-slate-950 hover:bg-yellow-300 disabled:cursor-not-allowed disabled:opacity-60"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock">
                        <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                      </svg>
                      Block
                    </button>

                    <div *ngIf="isBusy(u.email)" class="h-4 w-4 animate-spin rounded-full border-2 border-slate-700 border-t-slate-200"></div>
                  </div>
                </td>
              </tr>

              <tr *ngIf="vm.unblocked.length === 0">
                <td class="px-4 py-10 text-center text-slate-400" colspan="4">
                  No unblocked users found.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Blocked table -->
      <div *ngIf="activeTab==='blocked'" class="mt-4 overflow-hidden rounded-xl border border-slate-800 bg-slate-950">
        <div class="overflow-x-auto">
          <table class="min-w-full text-left text-sm">
            <thead class="bg-slate-900 text-slate-300">
              <tr>
                <th class="px-4 py-3 w-14"></th>
                <th class="px-4 py-3">User</th>
                <th class="px-4 py-3">Email</th>
                <th class="px-4 py-3">Reason</th>
                <th class="px-4 py-3 text-right">Action</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-slate-900">
              <tr *ngFor="let u of vm.blocked; trackBy: trackByUserEmail" class="hover:bg-slate-900/40">
                <!-- Photo -->
                <td class="px-4 py-3">
                  <div class="h-10 w-10 overflow-hidden rounded-full border border-slate-800 bg-slate-900">
                    <img *ngIf="u.imageUrl; else noPhotoB"
                         [src]="u.imageUrl"
                         class="h-full w-full object-cover"
                         alt="Profile photo" />
                    <ng-template #noPhotoB>
                      <div class="grid h-full w-full place-items-center text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user">
                          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                          <circle cx="12" cy="7" r="4"/>
                        </svg>
                      </div>
                    </ng-template>
                  </div>
                </td>

                <!-- Name -->
                <td class="px-4 py-3">
                  <div class="font-medium text-slate-100">{{ u.name }} {{ u.surname }}</div>
                  <div class="mt-0.5 text-xs text-slate-400">{{ u.address }}</div>
                </td>

                <!-- Email -->
                <td class="px-4 py-3">
                  <div class="flex items-center gap-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail text-slate-400">
                      <rect width="20" height="16" x="2" y="4" rx="2"/>
                      <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                    </svg>
                    <span class="truncate">{{ u.email }}</span>
                  </div>
                </td>

                <!-- Action -->
                <td class="px-4 py-3">
                  <div class="flex items-center justify-end gap-3">
                    <button
                      type="button"
                      (click)="unblock(u)"
                      [disabled]="isBusy(u.email)"
                      class="inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-3 py-2 text-sm font-semibold text-slate-950 hover:bg-emerald-400 disabled:cursor-not-allowed disabled:opacity-60"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-open">
                        <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
                      </svg>
                      Unblock
                    </button>

                    <div *ngIf="isBusy(u.email)" class="h-4 w-4 animate-spin rounded-full border-2 border-slate-700 border-t-slate-200"></div>
                  </div>
                </td>
              </tr>

              <tr *ngIf="vm.blocked.length === 0">
                <td class="px-4 py-10 text-center text-slate-400" colspan="5">
                  No blocked users found.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </ng-container>
  </div>
</div>
