<div class="p-6 max-w-7xl mx-auto">  

  <div *ngIf="isLoading" class="text-center py-20">
    <p class="text-xl text-gray-600">Loading drivers...</p>
  </div>

  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    <p>{{ errorMessage }}</p>
    <button (click)="refreshDrivers()" class="mt-2 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
      Retry
    </button>
  </div>

  <div *ngIf="!isLoading && !errorMessage">
    <!--Heading-->
    <div class="flex justify-between items-center mb-6">
      <!-- Left side: Heading and count -->
      <div>
        <h1 class="text-3xl font-bold text-white">Driver Management</h1>
        <p class="text-gray-400 mt-1">Active driver {{ totalDrivers }}</p>
      </div>
      
      <!-- Right side: Button -->
      <button routerLink="/admin/create-driver" class="bg-yellow-400 text-black px-6 py-2 rounded font-semibold hover:bg-yellow-500">
        Add New Driver
      </button>
    </div>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <!-- Active Drivers -->
      <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 flex items-center gap-4">
        <div class="bg-green-500/20 rounded-lg p-3 inline-flex">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check-icon lucide-user-check">
            <path d="m16 11 2 2 4-4"/>
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
          </svg>
        </div>

        <div>
          <p class="text-gray-400 text-sm">Active Drivers</p>
          <p class="text-white text-3xl font-bold">{{ activeDrivers }}</p>
        </div>
      </div>

      <!-- Inactive Drivers -->
      <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 flex items-center gap-4">
        <div class="bg-yellow-400/20 rounded-lg p-3 inline-flex">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#facc15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-off-icon lucide-shield-off">
            <path d="m2 2 20 20"/>
            <path d="M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71"/>
            <path d="M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264"/>
          </svg>
        </div>

        <div>
          <p class="text-gray-400 text-sm">Inactive Drivers</p>
          <p class="text-white text-3xl font-bold">{{ inactiveDrivers }}</p>
        </div>
      </div>

      <!-- Suspended Drivers -->
      <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 flex items-center gap-4">
        <div class="bg-red-500/20 rounded-lg p-3 inline-flex">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ban-icon lucide-ban">
            <path d="M4.929 4.929 19.07 19.071"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
        </div>

        <div>
          <p class="text-gray-400 text-sm">Suspended Drivers</p>
          <p class="text-white text-3xl font-bold">{{ suspendedDrivers }}</p>
        </div>
      </div>

      <!-- Average Rating -->
      <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 flex items-center gap-4">
        <div class="bg-yellow-400/20 rounded-lg p-3 inline-flex">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#facc15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star-icon lucide-star">
        <path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/>
      </svg>
    </div>

    <div>
      <p class="text-gray-400 text-sm">Avg Rating</p>
      <p class="text-white text-3xl font-bold">{{ avgRating }}</p>
    </div>
  </div>
    </div>
    
    <!-- Filter and search Buttons -->
    <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 mb-6">
      <div class="flex items-center gap-4">
        <!-- Search Bar -->
        <div class="flex-1 relative">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search absolute left-3 top-1/2 transform -translate-y-1/2">
            <path d="m21 21-4.34-4.34"/>
            <circle cx="11" cy="11" r="8"/>
          </svg>
          <input 
            type="search" 
            placeholder="Search drivers..." 
            [(ngModel)]="searchTerm"
            (ngModelChange)="filterDrivers()"
            class="w-full bg-gray-900 border border-gray-700 rounded-lg pl-10 pr-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400"
          />
        </div>
        
        <!-- Filter Buttons -->
        <div class="flex gap-2">
          <button (click)="filterByStatus('ALL')" class="bg-black text-white px-4 py-2 rounded border border-gray-600 hover:bg-gray-900">
            All
          </button>
          <button (click)="filterByStatus('ACTIVE')" class="bg-black text-white px-4 py-2 rounded border border-gray-600 hover:bg-gray-900">
            Active
          </button>
          <button (click)="filterByStatus('INACTIVE')" class="bg-black text-white px-4 py-2 rounded border border-gray-600 hover:bg-gray-900">
            Inactive
          </button>
          <button (click)="filterByStatus('SUSPENDED')" class="bg-black text-white px-4 py-2 rounded border border-gray-600 hover:bg-gray-900">
            Suspended
          </button>
        </div>
      </div>
    </div>

    <!-- Drivers Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full bg-gray-800 border border-gray-700">
        <thead class="bg-gray-900">
          <tr>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Driver</th>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Vehicle</th>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Rating</th>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Total Rides</th>
            <th class="px-6 py-3 border-b border-gray-700 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Earnings</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let driver of filteredDrivers" class="hover:bg-gray-750 border-b border-gray-700">
            <!-- Driver Column -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <img [src]="'http://localhost:8081/api/users/' + driver.id + '/profile-image'"
     [alt]="driver.name" 
     class="w-10 h-10 rounded-full object-cover">
                <div>
                  <p class="text-white font-medium">{{ driver.name }} {{ driver.surname }}</p>
                  <p class="text-gray-400 text-sm">{{ driver.email }}</p>
                </div>
              </div>
            </td>

            <!-- Vehicle Column -->
            <td class="px-6 py-4">
              <p class="text-white">{{ driver.vehicle.model }}</p>
              <p class="text-gray-400 text-sm">{{ driver.vehicle.licenseNumber }}</p>
            </td>

            <!-- Status Column -->
            <td class="px-6 py-4">
              <div class="flex flex-col gap-2">
                <span *ngIf="driver.blocked" class="px-3 py-1 text-xs font-semibold rounded-full bg-red-500/20 text-red-500 border border-red-500/30">
                  Suspended
                </span>
                <span *ngIf="driver.active" class="px-3 py-1 text-xs font-semibold rounded-full bg-green-500/20 text-green-500 border border-green-500/30">
                  Active
                </span>
                <span *ngIf="!driver.active" class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-400/20 text-yellow-400 border border-yellow-400/30">
                  Inactive
                </span>
              </div>
            </td>

            <!-- TODO: Use real data instead of random values for these 3 -->
            <!-- Rating Column -->
            <td class="px-6 py-4">
              <ng-container *ngIf="getRandomRating() as rating">
                <div class="flex gap-1">
                  <ng-container *ngFor="let star of [1,2,3,4,5]">
                    <!-- Filled star -->
                    <svg *ngIf="star <= rating" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="#facc15" stroke="#facc15" stroke-width="2">
                      <path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/>
                    </svg>
                    <!-- Empty star -->
                    <svg *ngIf="star > rating" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="#6b7280" stroke-width="2">
                      <path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/>
                    </svg>
                  </ng-container>
                </div>
              </ng-container>
            </td>

            <!-- Total Rides Column -->
            <td class="px-6 py-4 text-white">{{ getRandomRides() }}</td>

            <!-- Earnings Column -->
            <td class="px-6 py-4 text-white font-semibold">{{ getRandomEarnings() }} RSD</td>

          </tr>
        </tbody>
      </table>
      
      <p *ngIf="filteredDrivers.length === 0" class="text-center py-8 text-gray-400 bg-gray-800">
        No drivers found
      </p>
    </div>

  </div>
</div>
