<div class="min-h-screen bg-black text-white p-6">
  <div class="max-w-7xl mx-auto">

    <!-- Header -->
    <div class="flex flex-col gap-4 pt-4 mb-6">
      <h2 class="text-2xl font-bold">Ride History</h2>
      <p class="text-gray-400 text-sm">View ride history for any driver or passenger</p>
    </div>

    <!-- Search Controls -->
    <div id="search-controls" class="bg-gray-900 border border-gray-800 rounded-xl p-4 mb-6">
      <div class="flex flex-wrap items-end gap-4">
        <!-- Search Type -->
        <div class="flex flex-col gap-1.5">
          <label class="text-xs text-gray-400 uppercase tracking-wider">Search By</label>
          <div class="flex gap-2 bg-gray-800 p-1 rounded-lg">
            <button
              id="search-type-driver"
              (click)="searchType = 'driver'"
              class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
              [ngClass]="{
                'bg-yellow-500 text-black': searchType === 'driver',
                'text-gray-400 hover:text-white hover:bg-gray-700': searchType !== 'driver'
              }"
            >Driver</button>
            <button
              id="search-type-passenger"
              (click)="searchType = 'passenger'"
              class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
              [ngClass]="{
                'bg-yellow-500 text-black': searchType === 'passenger',
                'text-gray-400 hover:text-white hover:bg-gray-700': searchType !== 'passenger'
              }"
            >Passenger</button>
          </div>
        </div>

        <!-- User ID Input -->
        <div class="flex flex-col gap-1.5">
          <label class="text-xs text-gray-400 uppercase tracking-wider">{{ searchType === 'driver' ? 'Driver' : 'Passenger' }} ID</label>
          <input
            id="search-id-input"
            type="number"
            [(ngModel)]="searchId"
            (keyup.enter)="onSearch()"
            placeholder="Enter ID..."
            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-yellow-500/50 w-40"
          />
        </div>

        <!-- Search Button -->
        <button
          id="search-btn"
          (click)="onSearch()"
          class="px-6 py-2 bg-yellow-500 text-black rounded-lg text-sm font-medium hover:bg-yellow-400 transition-colors"
        >
          Search
        </button>

        <!-- Clear Button -->
        <button
          id="clear-search-btn"
          *ngIf="searchId"
          (click)="clearSearch()"
          class="px-4 py-2 bg-gray-700 text-white rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors"
        >
          Clear
        </button>

        <div class="flex-1"></div>

        <!-- Date Filter -->
        <div class="flex flex-col gap-1.5">
          <label class="text-xs text-gray-400 uppercase tracking-wider">Filter by Date</label>
          <div class="relative flex items-center gap-2">
            <div class="relative">
              <input
                id="date-filter-input"
                type="date"
                [(ngModel)]="dateFilter"
                (change)="loadRides()"
                class="pl-10 pr-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-yellow-500/50"
              />
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="16" 
                height="16" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                stroke-width="2" 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                class="text-gray-400 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"
              >
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                <line x1="16" x2="16" y1="2" y2="6"/>
                <line x1="8" x2="8" y1="2" y2="6"/>
                <line x1="3" x2="21" y1="10" y2="10"/>
              </svg>
            </div>
            <button
              id="clear-date-btn"
              *ngIf="dateFilter"
              (click)="dateFilter = ''; loadRides()"
              class="p-2 hover:bg-gray-700 rounded-lg transition-colors"
              title="Clear date filter"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
          </div>
        </div>

        <!-- Status Filter -->
        <div class="flex flex-col gap-1.5">
          <label class="text-xs text-gray-400 uppercase tracking-wider">Status</label>
          <select
            id="status-filter"
            [(ngModel)]="statusFilter"
            (change)="loadRides()"
            class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-yellow-500/50"
          >
            <option *ngFor="let status of statusOptions" [value]="status">
              {{ status === 'all' ? 'All Statuses' : formatStatus(status) }}
            </option>
          </select>
        </div>
      </div>

      <!-- Selected User Info -->
      <div *ngIf="selectedUserName" class="mt-4 pt-4 border-t border-gray-800 flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center text-yellow-500 font-bold">
          {{ selectedUserName.charAt(0) }}
        </div>
        <div>
          <p class="text-sm font-medium text-white">{{ selectedUserName }}</p>
          <p class="text-xs text-gray-400">{{ selectedUserEmail }}</p>
        </div>
        <div id="rides-count" class="ml-4 px-3 py-1 rounded-full bg-gray-800 border border-gray-700 text-xs text-gray-300">
          {{ rides.length }} ride{{ rides.length !== 1 ? 's' : '' }} found
        </div>
      </div>

      <!-- All Rides Summary (when no search) -->
      <div *ngIf="!searchId && rides.length > 0" class="mt-4 pt-4 border-t border-gray-800 flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </div>
        <div>
          <p class="text-sm font-medium text-white">All Rides</p>
          <p class="text-xs text-gray-400">Showing all ride history</p>
        </div>
        <div id="all-rides-count" class="ml-4 px-3 py-1 rounded-full bg-gray-800 border border-gray-700 text-xs text-gray-300">
          {{ rides.length }} ride{{ rides.length !== 1 ? 's' : '' }} found
        </div>
      </div>
    </div>

    <!-- Selected Ride Details -->
    <div *ngIf="selectedRide" id="ride-detail-panel" class="mb-6 bg-gray-900 border border-gray-800 rounded-xl overflow-hidden shadow-lg">
      <div class="p-4 border-b border-gray-800 flex flex-col sm:flex-row justify-between items-center bg-gray-800/50 gap-4">
        <div class="flex items-center gap-3">
          <h3 id="ride-detail-title" class="text-lg font-semibold text-white">Ride Details</h3>
          <span id="ride-detail-status" class="text-xs px-2 py-1 rounded border" [ngClass]="getStatusClass(selectedRide.status)">
            {{ formatStatus(selectedRide.status) }}
          </span>
          <span *ngIf="selectedRide.panicPressed" id="ride-detail-panic-badge" class="text-xs px-2 py-1 rounded bg-red-600/30 text-red-300 border border-red-600/50 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            PANIC
          </span>
          <button id="ride-detail-close" (click)="closeDetails()" class="p-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white transition-colors" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
          </button>
        </div>
        <div class="flex flex-wrap gap-2">
          <button (click)="orderAgain()" class="px-3 py-1.5 bg-yellow-500 text-black rounded-lg text-sm font-medium hover:bg-yellow-400 transition-colors">Order Again</button>
          <button (click)="scheduleLater()" class="px-3 py-1.5 bg-gray-700 text-white rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors">Schedule Later</button>
        </div>
      </div>

      <div class="flex flex-col lg:flex-row h-[500px] lg:h-[450px]">
        <!-- Map -->
        <div class="w-full lg:w-1/2 h-1/2 lg:h-full bg-gray-950 relative border-b lg:border-b-0 lg:border-r border-gray-800">
          <div id="admin-history-map" class="w-full h-full z-0"></div>
        </div>

        <!-- Info -->
        <div class="w-full lg:w-1/2 p-6 overflow-y-auto space-y-6 custom-scrollbar bg-gray-900">

          <!-- Route -->
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <div class="mt-1.5 w-2 h-2 rounded-full bg-green-500 shrink-0 shadow-[0_0_8px_#22c55e]"></div>
              <div>
                <p class="text-xs text-gray-400 uppercase tracking-wider mb-0.5">Pickup</p>
                <p id="ride-detail-pickup" class="text-sm font-medium text-white">{{ getLocationAddress(selectedRide, 'start') }}</p>
                <p class="text-xs text-gray-500 mt-0.5">{{ formatDate(selectedRide.startTime) }}</p>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div class="mt-1.5 w-2 h-2 rounded-full bg-red-500 shrink-0 shadow-[0_0_8px_#ef4444]"></div>
              <div>
                <p class="text-xs text-gray-400 uppercase tracking-wider mb-0.5">Destination</p>
                <p id="ride-detail-destination" class="text-sm font-medium text-white">{{ getLocationAddress(selectedRide, 'end') }}</p>
                <p class="text-xs text-gray-500 mt-0.5">{{ formatDate(selectedRide.endTime) }}</p>
              </div>
            </div>
          </div>

          <!-- Ride Stats -->
          <div class="grid grid-cols-2 gap-3">
            <div class="p-3 bg-gray-800/50 border border-gray-700 rounded-lg">
              <p class="text-[10px] text-gray-500 uppercase tracking-wider">Cost</p>
              <p id="ride-detail-cost" class="text-lg font-bold text-yellow-500">{{ formatPrice(selectedRide.totalCost) }}</p>
            </div>
            <div class="p-3 bg-gray-800/50 border border-gray-700 rounded-lg">
              <p class="text-[10px] text-gray-500 uppercase tracking-wider">Distance</p>
              <p id="ride-detail-distance" class="text-lg font-bold text-white">{{ formatDistance(selectedRide.distanceKm || selectedRide.estimatedDistance) }}</p>
            </div>
          </div>

          <!-- Cancellation Info -->
          <div *ngIf="selectedRide.status?.includes('CANCELLED')" class="p-4 bg-red-950/30 border border-red-900/30 rounded-lg">
            <div class="flex items-center gap-2 mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-400"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
              <p class="text-sm text-red-400 font-medium">Cancelled by {{ getCancelledBy(selectedRide) }}</p>
            </div>
            <p *ngIf="selectedRide.rejectionReason" class="text-xs text-red-300 pl-6">{{ selectedRide.rejectionReason }}</p>
          </div>

          <!-- Panic Info -->
          <div *ngIf="selectedRide.panicPressed" class="p-4 bg-red-950/30 border border-red-900/30 rounded-lg">
            <div class="flex items-center gap-2 mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-400"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <p class="text-sm text-red-400 font-medium">PANIC Button Activated</p>
            </div>
            <p *ngIf="selectedRide.panicReason" class="text-xs text-red-300 pl-6">{{ selectedRide.panicReason }}</p>
          </div>

          <div class="w-full h-px bg-gray-800"></div>

          <!-- Driver -->
          <div *ngIf="selectedRide.driver" id="ride-detail-driver-section" class="space-y-4">
            <h4 class="text-sm font-medium text-gray-300 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              Driver
            </h4>
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-full bg-gray-800 border-2 border-yellow-500/30 flex items-center justify-center text-gray-400 overflow-hidden shrink-0">
                <img *ngIf="selectedRide.driver.profilePictureUrl" [src]="selectedRide.driver.profilePictureUrl" class="w-full h-full object-cover">
                <span *ngIf="!selectedRide.driver.profilePictureUrl" class="text-lg font-bold text-yellow-500">{{ selectedRide.driver.name?.charAt(0) }}</span>
              </div>
              <div class="flex-1">
                <p id="ride-detail-driver-name" class="text-sm font-semibold text-white">{{ selectedRide.driver.name }} {{ selectedRide.driver.surname }}</p>
                <p id="ride-detail-driver-email" class="text-xs text-gray-400">{{ selectedRide.driver.email }}</p>
                <p *ngIf="selectedRide.driver.phoneNumber" class="text-xs text-gray-500">{{ selectedRide.driver.phoneNumber }}</p>
              </div>
            </div>

            <!-- Vehicle -->
            <div *ngIf="selectedRide.driver.vehicle" class="p-3 bg-gray-800/50 border border-gray-700 rounded-lg">
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div>
                  <span class="text-gray-500">Model:</span>
                  <span class="text-white ml-1">{{ selectedRide.driver.vehicle.model }}</span>
                </div>
                <div>
                  <span class="text-gray-500">Plates:</span>
                  <span class="text-white ml-1">{{ selectedRide.driver.vehicle.licenseNumber }}</span>
                </div>
                <div>
                  <span class="text-gray-500">Type:</span>
                  <span class="text-white ml-1">{{ selectedRide.driver.vehicle.vehicleType }}</span>
                </div>
                <div>
                  <span class="text-gray-500">Seats:</span>
                  <span class="text-white ml-1">{{ selectedRide.driver.vehicle.passengerSeats }}</span>
                </div>
              </div>
              <div class="flex gap-2 mt-2">
                <span *ngIf="selectedRide.driver.vehicle.babyTransport" class="text-[10px] px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400 border border-blue-500/20">Baby Seat</span>
                <span *ngIf="selectedRide.driver.vehicle.petTransport" class="text-[10px] px-2 py-0.5 rounded-full bg-green-500/10 text-green-400 border border-green-500/20">Pet Friendly</span>
              </div>
            </div>
          </div>

          <!-- Passengers -->
          <div *ngIf="selectedRide.passengers?.length" id="ride-detail-passengers-section" class="space-y-3">
            <h4 class="text-sm font-medium text-gray-300 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Passengers ({{ selectedRide.passengers?.length || 0 }})
            </h4>
            <div class="space-y-2">
              <div *ngFor="let passenger of selectedRide.passengers" class="flex items-center gap-3 p-2 bg-gray-800/30 rounded-lg">
                <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-300">
                  {{ passenger.name?.charAt(0) || '?' }}
                </div>
                <div>
                  <p class="text-sm text-white">{{ passenger.name }} {{ passenger.surname }}</p>
                  <p class="text-xs text-gray-500">{{ passenger.email }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Inconsistencies -->
          <div *ngIf="selectedRide.inconsistencyReports?.length" class="p-4 bg-red-950/30 border border-red-900/30 rounded-lg">
            <div class="flex items-center gap-2 mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-400"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <p class="text-sm text-red-400 font-medium">Inconsistency Reports</p>
            </div>
            <ul class="space-y-1">
              <li *ngFor="let rep of selectedRide.inconsistencyReports" class="text-xs text-red-300 pl-6 relative before:content-['•'] before:absolute before:left-2 before:text-red-500">
                {{ rep.description }}
              </li>
            </ul>
          </div>

          <!-- Reviews -->
          <div *ngIf="selectedRide.reviews?.length" id="ride-detail-reviews-section" class="space-y-3">
            <h4 class="text-sm font-medium text-gray-300 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              Ratings
            </h4>
            <div class="space-y-2">
              <div *ngFor="let review of selectedRide.reviews" class="review-card p-3 border border-gray-800 rounded-lg bg-gray-800/20">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1 bg-yellow-500/10 px-2 py-0.5 rounded text-yellow-500 border border-yellow-500/20">
                      <span class="text-[10px] font-bold uppercase">Driver</span>
                      <span class="text-xs font-bold">{{ review.driverRating }}</span>
                    </div>
                    <div class="flex items-center gap-1 bg-yellow-500/10 px-2 py-0.5 rounded text-yellow-500 border border-yellow-500/20">
                      <span class="text-[10px] font-bold uppercase">Vehicle</span>
                      <span class="text-xs font-bold">{{ review.vehicleRating }}</span>
                    </div>
                  </div>
                  <span class="text-[10px] text-gray-500">{{ formatDate(review.createdAt) }}</span>
                </div>
                <p class="text-sm text-gray-300 italic pl-1 border-l-2 border-gray-700 py-1" *ngIf="review.comment">"{{ review.comment }}"</p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Rides Table -->
    <div id="rides-table-container" class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden">
      <div class="overflow-x-auto">
        <table id="rides-table" class="w-full text-sm text-left">
          <thead>
            <tr class="border-b border-gray-800 bg-gray-900/50">
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-start-time" (click)="handleSort('startTime')" class="flex items-center gap-2 hover:text-white transition-colors">
                  Start Time
                  <span *ngIf="sortField !== 'startTime'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'startTime'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-end-time" (click)="handleSort('endTime')" class="flex items-center gap-2 hover:text-white transition-colors">
                  End Time
                  <span *ngIf="sortField !== 'endTime'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'endTime'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-route" (click)="handleSort('departure')" class="flex items-center gap-2 hover:text-white transition-colors">
                  Route
                  <span *ngIf="sortField !== 'departure'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'departure'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-status" (click)="handleSort('status')" class="flex items-center gap-2 hover:text-white transition-colors">
                  Status
                  <span *ngIf="sortField !== 'status'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'status'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-cost" (click)="handleSort('totalCost')" class="flex items-center gap-2 hover:text-white transition-colors">
                  Cost
                  <span *ngIf="sortField !== 'totalCost'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'totalCost'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-cancelled-by" (click)="handleSort('cancelledBy')" class="flex items-center gap-2 hover:text-white transition-colors">
                  Cancelled By
                  <span *ngIf="sortField !== 'cancelledBy'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'cancelledBy'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
              <th class="p-4 font-semibold text-gray-300">
                <button id="sort-panic" (click)="handleSort('panic')" class="flex items-center gap-2 hover:text-white transition-colors">
                  PANIC
                  <span *ngIf="sortField !== 'panic'" class="opacity-30">▼</span>
                  <span *ngIf="sortField === 'panic'" class="text-yellow-500">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
                </button>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="rides.length === 0">
              <td id="no-rides-message" colspan="7" class="p-8 text-center text-gray-500">
                No rides found
              </td>
            </tr>
            <tr 
              *ngFor="let ride of rides; let i = index"
              [attr.id]="'ride-row-' + i"
              (click)="onRideSelected(ride)"
              class="border-b border-gray-800 hover:bg-gray-800/50 cursor-pointer transition-colors relative"
              [ngClass]="{
                'outline outline-2 outline-red-500 z-10': ride.panicPressed,
                'bg-gray-800/30': selectedRide?.id === ride.id
              }"
            >
              <!-- Start Time -->
              <td class="p-4">
                <div class="flex flex-col">
                  <span class="font-medium text-white ride-start-date">{{ formatShortDate(ride.startTime) }}</span>
                  <span class="text-gray-400 ride-start-time">{{ formatTime(ride.startTime) }}</span>
                </div>
              </td>

              <!-- End Time -->
              <td class="p-4">
                <div class="flex flex-col">
                  <span class="font-medium text-white ride-end-date">{{ formatShortDate(ride.endTime) }}</span>
                  <span class="text-gray-400 ride-end-time">{{ formatTime(ride.endTime) }}</span>
                </div>
              </td>

              <!-- Route -->
              <td class="p-4 max-w-xs">
                <div class="flex flex-col gap-1">
                  <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                    <span class="text-white text-xs truncate ride-pickup">{{ getLocationAddress(ride, 'start') }}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-red-500"></div>
                    <span class="text-gray-400 text-xs truncate ride-destination">{{ getLocationAddress(ride, 'end') }}</span>
                  </div>
                </div>
              </td>

              <!-- Status -->
              <td class="p-4">
                <span class="text-xs px-2 py-1 rounded border ride-status" [ngClass]="getStatusClass(ride.status)">
                  {{ formatStatus(ride.status) }}
                </span>
              </td>

              <!-- Cost -->
              <td class="p-4">
                <span class="text-yellow-500 font-medium ride-cost">{{ formatPrice(ride.totalCost) }}</span>
              </td>

              <!-- Cancelled By -->
              <td class="p-4">
                <span class="text-gray-400 text-xs ride-cancelled-by">{{ getCancelledBy(ride) }}</span>
              </td>

              <!-- PANIC -->
              <td class="p-4">
                <span *ngIf="ride.panicPressed" class="text-xs px-2 py-1 rounded bg-red-600/30 text-red-300 border border-red-600/50 ride-panic">
                  YES
                </span>
                <span *ngIf="!ride.panicPressed" class="text-gray-600 text-xs ride-panic">—</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
