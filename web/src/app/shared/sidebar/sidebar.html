<!-- Mobile overlay -->
<div 
  *ngIf="isOpen"
  class="fixed inset-0 bg-black/50 z-40 lg:hidden"
  (click)="close()"
></div>

<!-- Logout Error Modal -->
<div 
  *ngIf="showLogoutError"
  class="fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4"
  (click)="closeLogoutError()"
>
  <div 
    class="bg-[#1C1C1E] rounded-2xl border border-gray-800 max-w-md w-full p-6 shadow-xl"
    (click)="$event.stopPropagation()"
  >
    <!-- Warning Icon -->
    <div class="flex justify-center mb-4">
      <div class="w-16 h-16 rounded-full bg-yellow-500/10 border border-yellow-500/20 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
    </div>

    <!-- Title -->
    <h3 class="text-xl font-bold text-white text-center mb-2">Cannot Logout</h3>
    
    <!-- Message -->
    <p class="text-gray-400 text-center mb-6">{{ logoutErrorMessage }}</p>

    <!-- Buttons -->
    <div class="flex flex-col gap-3">
      <button 
        (click)="goToDashboard()"
        class="w-full py-3 px-4 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold rounded-xl transition-colors"
      >
        Go to Dashboard
      </button>
      <button 
        (click)="closeLogoutError()"
        class="w-full py-3 px-4 bg-gray-800 hover:bg-gray-700 text-white font-medium rounded-xl transition-colors"
      >
        Close
      </button>
    </div>
  </div>
</div>

<!-- Sidebar -->
<aside 
  class="fixed lg:relative top-0 left-0 min-h-screen h-full bg-black border-r border-gray-800
         z-50 flex flex-col transition-all duration-300 whitespace-nowrap overflow-hidden"
  [class.w-64]="true"
  [class.translate-x-0]="isOpen"
  [class.-translate-x-full]="!isOpen"
  [class.lg:translate-x-0]="true"
  [class.lg:w-64]="isOpen"
  [class.lg:w-0]="!isOpen"
  [class.lg:border-r]="isOpen"
  [class.lg:border-r-0]="!isOpen"
>
  <div class="flex h-16 items-center px-6 border-b border-gray-800 min-w-[16rem]">
    <h2 class="text-xl font-bold text-white">Rides</h2>
  </div>
  
  <nav class="flex-1 p-4 space-y-1 min-w-[16rem]">
    <ng-container *ngFor="let item of items">
      <!-- Items with route (normal navigation) -->
      <a *ngIf="!item.action && item.icon !== 'logout'"
         [routerLink]="item.route"
         (click)="onItemClick(item)"
         class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors cursor-pointer"
         [ngClass]="{
           'text-red-500 hover:bg-red-500/10': item.variant === 'danger',
           'bg-gray-800 text-white': item.active && item.variant !== 'danger',
           'text-gray-400 hover:bg-gray-800/50': !item.active && item.variant !== 'danger'
         }"
      >
        <ng-container *ngTemplateOutlet="iconTemplate; context: { item: item }"></ng-container>
        <span class="flex-1 text-left">{{ item.label }}</span>
        <span *ngIf="item.badge" class="px-2 py-0.5 bg-white text-black text-xs rounded-full font-bold">
          {{ item.badge }}
        </span>
      </a>

      <!-- Items with action (like Active Ride) -->
      <button *ngIf="item.action"
         (click)="onItemClick(item)"
         [disabled]="item.icon === 'active-ride' && !hasActiveRide"
         class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors cursor-pointer"
         [ngClass]="{
           'bg-yellow-500/20 text-yellow-500 hover:bg-yellow-500/30': item.icon === 'active-ride' && hasActiveRide,
           'text-gray-600 cursor-not-allowed': item.icon === 'active-ride' && !hasActiveRide,
           'bg-gray-800 text-white': item.active && item.icon !== 'active-ride',
           'text-gray-400 hover:bg-gray-800/50': !item.active && item.icon !== 'active-ride' && hasActiveRide
         }"
      >
        <ng-container *ngTemplateOutlet="iconTemplate; context: { item: item }"></ng-container>
        <span class="flex-1 text-left">{{ item.label }}</span>
        <span *ngIf="item.icon === 'active-ride' && hasActiveRide" class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></span>
      </button>

      <!-- Logout item -->
      <a *ngIf="item.icon === 'logout'"
         (click)="onItemClick(item)"
         class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors cursor-pointer text-red-500 hover:bg-red-500/10"
      >
        <ng-container *ngTemplateOutlet="iconTemplate; context: { item: item }"></ng-container>
        <span class="flex-1 text-left">{{ item.label }}</span>
      </a>
    </ng-container>
  </nav>

  <!-- Icon Template -->
  <ng-template #iconTemplate let-item="item">
    <ng-container [ngSwitch]="item.icon">
      <svg *ngSwitchCase="'dashboard'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
      <svg *ngSwitchCase="'earnings'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      <svg *ngSwitchCase="'profile'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <svg *ngSwitchCase="'support'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
      <svg *ngSwitchCase="'logout'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
      <svg *ngSwitchCase="'home'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <svg *ngSwitchCase="'history'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>
      <svg *ngSwitchCase="'reports'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>
      <svg *ngSwitchCase="'drivers'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      <svg *ngSwitchCase="'pricing'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      <svg *ngSwitchCase="'favorite'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
      <!-- Requests icon (clipboard/checklist) -->
      <svg *ngSwitchCase="'requests'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="m9 14 2 2 4-4"/></svg>
      <!-- Active Ride icon (car) -->
      <svg *ngSwitchCase="'active-ride'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>
      <!-- Panic alert icon -->
      <svg *ngSwitchCase="'panic'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    </ng-container>
  </ng-template>
</aside>
